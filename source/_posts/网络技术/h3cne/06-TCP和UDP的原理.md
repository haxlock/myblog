---
title: 06-TCP和UDP的原理
date: 2025-04-01 13:24:49
tags: 网络技术
categories: 
- [网络技术]
---

# 传输层的作用
<!-- more -->
- 提供面向连接(   tcp)或无连接(udp)的服务

- 维护连接状态

- 对应用层数据进行分段和封装

- 实现多路复用

- 可靠地传输数据

- 执行流量控制

# TCP封装

[![pEyefFH.png](https://s21.ax1x.com/2025/04/01/pEyefFH.png)](https://imgse.com/i/pEyefFH)

- window 窗口尺寸 用来通告本机的接受能力

- Checksum 校验序列 用来校验收到的tcp报文是否正确，做hash校验，确认数据包没被篡改过

- Urgent Pointer 紧急指针

- Options 可选项

- Padding 必须是四字节的倍数，填充0到四字节

# 端口

多路复用

- 每个应用程序进出网络都需要经过一个唯一的端口，通过端口号来识别数据交由那个应用程序处理(例如：http是基于tcp的80端口的网站服务)

- 服务端：固定端口号

- 客户端：1024以上随机端口

- 常见端口号(1024以下)有：

- - TCP80 HTTP 超文本传输协议
  
  - TCP20 21 FTP 文本传输协议
  
  - TCP23 TELNET 远程登录
  
  - TCP25 SMTP 简单邮件传输协议
  
  - UDP53 DNS 域名解析协议
  
  - TCP443 HTTPS HTTP over SSL

# Tcp可靠性机制

## seq和ack的理解

[![pEymVh9.png](https://s21.ax1x.com/2025/04/01/pEymVh9.png)](https://imgse.com/i/pEymVh9)

截取了课上的老师画的草图，对其理解一下

- A向B发送一个数据包，会**随机产生**一个**seq序列号**，例如为100

- B会向A回馈一个确认号ack，为101，表明：我已经收到你100的数据，下次请从101号发给我。同时也会产生一个seq序列号，例如为10，表明向A表明，这是我向你发送的第10号数据。

- 当A收到B的数据包并确认后，会发送一个ack:11，收到后没问题，下次给我发11号。与此同时，seq数据同时也是101，因为第一次表明了下次需要从101号开始发，因此，给B发送101号数据。

- 再来一层，B再向A发数据时候，此时ack为，101号数据已收到，下次请发102号数据。seq此时就是11，上次ack确认11号，需要下次发11号，那我就发11号。

- 后面，如果比方说B向A发的有问题，那么此时，我A给B的ack仍为11，我不确认，发给你，在给我发一次，这就是TCP的传输确认机制。

### 真实情况

发多个，回一个

[![pEymqjx.md.png](https://s21.ax1x.com/2025/04/01/pEymqjx.md.png)](https://imgse.com/i/pEymqjx)

由于之前发了4096个数据，那么下一次数据是从4097发出

## TCP可靠性机制

### 确认机制

- Seq=上一次ack

- Ack=上一次seq+length

- 如果没有收到，或者验证不完整，则会再次发送Ack请求对方重发

## Data Offset

 数据偏移量，标识数据分段在完整数据中的位置

## Reserved

保留位，空的位置，啥也没有

## 六个Flags标志位

- 紧急标志位URG，表明是否有紧急指针

- 确认标志位ACK，回应请求，ack和syn都是1

- SYN：1代表这是一个握手请求，请求建立连接关系

- Rst：复位开关

- Fin：结束开关

- Psh：直接提交缓存数据

## 三次握手过程

建立可靠连接

## 窗口机制

流量控制

滑动窗口

通过通告对方本机接受能力来实现流量控制

# UDP基本原理

[![pEy2Ze1.png](https://s21.ax1x.com/2025/04/02/pEy2Ze1.png)](https://imgse.com/i/pEy2Ze1)

UDP属于三不管，只管发，所以属于是不可靠的传输方法

UDP的传输延迟要小于TCP

# TCP特征

- 优点：传输可靠性高

- 缺点：占用带宽大，传输延迟高

# TCP适用场景

对数据的完整性要求高，但是对传输延迟要求低

# UDP特征

- 优点：占用贷款低，传输延迟低

- 缺点：没有任何可靠性机制

- 适用场景：对传输延迟要求高，但数据完整性要求低

# 对比

[![pEy2uFK.png](https://s21.ax1x.com/2025/04/02/pEy2uFK.png)](https://imgse.com/i/pEy2uFK)
